var Test = require('./test.js')

var tap = new Test()
module.exports = tap

if (tap._timer && tap._timer.unref) {
  tap._timer.unref()
}

tap._name = 'TAP'

// No sense continuing after bailout!
tap.on('bailout', function () {
  process.exit(1)
})

process.on('exit', function (code) {
  tap.endAll()

  if (!tap._ok && code === 0) {
    process.exit(1)
  }
})

// need to autoend if a teardown is added.
// otherwise we may never see process.on('exit')!
tap.tearDown = function (fn) {
  var ret = Test.prototype